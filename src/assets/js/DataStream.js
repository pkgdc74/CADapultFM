(function(t){function g(a,d,f){return d<=a&&a<=f}function n(a,d){return Math.floor(a/d)}function D(a){var d=0;this.get=function(){return d>=a.length?-1:Number(a[d])};this.offset=function(f){d+=f;if(0>d)throw Error("Seeking past start of the buffer");if(d>a.length)throw Error("Seeking past EOF");};this.match=function(f){if(f.length>d+a.length)return!1;var c;for(c=0;c<f.length;c+=1)if(Number(a[d+c])!==f[c])return!1;return!0}}function E(a){var d=0;this.emit=function(f){var c=-1,b;for(b=0;b<arguments.length;++b)c=
Number(arguments[b]),a[d++]=c;return c}}function F(a){var d=0,f=function(){for(var c=[],b=0,e=a.length;b<a.length;){var f=a.charCodeAt(b);if(g(f,55296,57343))if(g(f,56320,57343))c.push(65533);else if(b===e-1)c.push(65533);else{var d=a.charCodeAt(b+1);g(d,56320,57343)?(f&=1023,d&=1023,b+=1,c.push(65536+(f<<10)+d)):c.push(65533)}else c.push(f);b+=1}return c}();this.offset=function(c){d+=c;if(0>d)throw Error("Seeking past start of the buffer");if(d>f.length)throw Error("Seeking past EOF");};this.get=
function(){return d>=f.length?-1:f[d]}}function G(){var a="";this.string=function(){return a};this.emit=function(d){65535>=d?a+=String.fromCharCode(d):(d-=65536,a+=String.fromCharCode(55296+(d>>10&1023)),a+=String.fromCharCode(56320+(d&1023)))}}function l(a,d){if(a)throw Error("EncodingError");return d||65533}function q(a){throw Error("EncodingError");}function v(a){a=String(a).trim().toLowerCase();if(Object.prototype.hasOwnProperty.call(w,a))return w[a];throw Error("EncodingError: Unknown encoding: "+
a);}function u(a,d){return(d||[])[a]||null}function r(a,d){var f=d.indexOf(a);return-1===f?null:f}function H(a){var d=a.fatal,f=0,c=0,b=0,e=0;this.decode=function(a){var h=a.get();if(-1===h)return 0!==c?l(d):-1;a.offset(1);if(0===c){if(g(h,0,127))return h;if(g(h,194,223))c=1,e=128,f=h-192;else if(g(h,224,239))c=2,e=2048,f=h-224;else if(g(h,240,244))c=3,e=65536,f=h-240;else return l(d);f*=Math.pow(64,c);return null}if(!g(h,128,191))return e=b=c=f=0,a.offset(-1),l(d);b+=1;f+=(h-128)*Math.pow(64,c-b);
if(b!==c)return null;a=f;h=e;e=b=c=f=0;return g(a,h,1114111)&&!g(a,55296,57343)?a:l(d)}}function I(a){this.encode=function(d,f){var c=f.get();if(-1===c)return-1;f.offset(1);if(g(c,55296,57343))return q(c);if(g(c,0,127))return d.emit(c);var b,e;g(c,128,2047)?(b=1,e=192):g(c,2048,65535)?(b=2,e=224):g(c,65536,1114111)&&(b=3,e=240);for(e=d.emit(n(c,Math.pow(64,b))+e);0<b;)e=n(c,Math.pow(64,b-1)),e=d.emit(128+e%64),--b;return e}}function J(a,d){var f=d.fatal;this.decode=function(c){var b=c.get();if(-1===
b)return-1;c.offset(1);if(g(b,0,127))return b;c=a[b-128];return null===c?l(f):c}}function K(a,d){this.encode=function(f,c){var b=c.get();if(-1===b)return-1;c.offset(1);if(g(b,0,127))return f.emit(b);var e=r(b,a);null===e&&q(b);return f.emit(e+128)}}function z(a,d){var f=d.fatal,c=0,b=0,e=0;this.decode=function(d){var h=d.get();if(-1===h&&0===c&&0===b&&0===e)return-1;-1!==h||0===c&&0===b&&0===e||(e=b=c=0,l(f));d.offset(1);var m;if(0!==e){m=null;if(g(h,48,57))if(h=10*(126*(10*(c-129)+(b-48))+(e-129))+
h-48,39419<h&&189E3>h||1237575<h)m=null;else{var n=0;m=0;var q=p.gb18030,r;for(r=0;r<q.length;++r){var t=q[r];if(t[0]<=h)n=t[0],m=t[1];else break}m=m+h-n}e=b=c=0;return null===m?(d.offset(-3),l(f)):m}if(0!==b){if(g(h,129,254))return e=h,null;d.offset(-2);b=c=0;return l(f)}if(0!==c){if(g(h,48,57)&&a)return b=h,null;m=c;n=null;c=0;q=127>h?64:65;if(g(h,64,126)||g(h,128,254))n=190*(m-129)+(h-q);m=null===n?null:u(n,p.gbk);null===n&&d.offset(-1);return null===m?l(f):m}return g(h,0,127)?h:128===h?8364:g(h,
129,254)?(c=h,null):l(f)}}function A(a,d){this.encode=function(f,c){var b=c.get();if(-1===b)return-1;c.offset(1);if(g(b,0,127))return f.emit(b);var e=r(b,p.gbk);if(null!==e)return b=n(e,190)+129,e%=190,f.emit(b,e+(63>e?64:65));if(null===e&&!a)return q(b);var d=e=0,h=p.gb18030,l;for(l=0;l<h.length;++l){var m=h[l];if(m[1]<=b)e=m[1],d=m[0];else break}e=d+b-e;b=n(n(n(e,10),126),10);e-=12600*b;d=n(n(e,10),126);e-=1260*d;h=n(e,10);return f.emit(b+129,d+48,h+129,e-10*h+48)}}function L(a){var d=a.fatal,f=
!1,c=0;this.decode=function(b){var e=b.get();if(-1===e&&0===c)return-1;if(-1===e&&0!==c)return c=0,l(d);b.offset(1);if(126===c){c=0;if(123===e)return f=!0,null;if(125===e)return f=!1,null;if(126===e)return 126;if(10===e)return null;b.offset(-1);return l(d)}if(0!==c){b=c;c=0;var a=null;g(e,33,126)&&(a=u(190*(b-1)+(e+63),p.gbk));10===e&&(f=!1);return null===a?l(d):a}if(126===e)return c=126,null;if(f){if(g(e,32,127))return c=e,null;10===e&&(f=!1);return l(d)}return g(e,0,127)?e:l(d)}}function M(a){var d=
!1;this.encode=function(f,c){var b=c.get();if(-1===b)return-1;c.offset(1);if(g(b,0,127)&&d)return c.offset(-1),d=!1,f.emit(126,125);if(126===b)return f.emit(126,126);if(g(b,0,127))return f.emit(b);if(!d)return c.offset(-1),d=!0,f.emit(126,123);var e=r(b,p.gbk);if(null===e)return q(b);var a=n(e,190)+1,e=e%190-63;return g(a,33,126)&&g(e,33,126)?f.emit(a,e):q(b)}}function N(a){var d=a.fatal,f=0,c=null;this.decode=function(b){if(null!==c)return b=c,c=null,b;var e=b.get();if(-1===e&&0===f)return-1;if(-1===
e&&0!==f)return f=0,l(d);b.offset(1);if(0!==f){var a=f,h=null;f=0;var m=127>e?64:98;if(g(e,64,126)||g(e,161,254))h=157*(a-129)+(e-m);if(1133===h)return c=772,202;if(1135===h)return c=780,202;if(1164===h)return c=772,234;if(1166===h)return c=780,234;e=null===h?null:u(h,p.big5);null===h&&b.offset(-1);return null===e?l(d):e}return g(e,0,127)?e:g(e,129,254)?(f=e,null):l(d)}}function O(a){this.encode=function(d,f){var c=f.get();if(-1===c)return-1;f.offset(1);if(g(c,0,127))return d.emit(c);var b=r(c,p.big5);
if(null===b)return q(c);c=n(b,157)+129;b%=157;return d.emit(c,b+(63>b?64:98))}}function P(a){var d=a.fatal,f=0,c=0;this.decode=function(b){var e=b.get();if(-1===e){if(0===f&&0===c)return-1;c=f=0;return l(d)}b.offset(1);var a,h;return 0!==c?(a=c,c=0,h=null,g(a,161,254)&&g(e,161,254)&&(h=u(94*(a-161)+e-161,p.jis0212)),g(e,161,254)||b.offset(-1),null===h?l(d):h):142===f&&g(e,161,223)?(f=0,65377+e-161):143===f&&g(e,161,254)?(f=0,c=e,null):0!==f?(a=f,f=0,h=null,g(a,161,254)&&g(e,161,254)&&(h=u(94*(a-161)+
e-161,p.jis0208)),g(e,161,254)||b.offset(-1),null===h?l(d):h):g(e,0,127)?e:142===e||143===e||g(e,161,254)?(f=e,null):l(d)}}function Q(a){this.encode=function(a,f){var c=f.get();if(-1===c)return-1;f.offset(1);if(g(c,0,127))return a.emit(c);if(165===c)return a.emit(92);if(8254===c)return a.emit(126);if(g(c,65377,65439))return a.emit(142,c-65377+161);var b=r(c,p.jis0208);if(null===b)return q(c);c=n(b,94)+161;return a.emit(c,b%94+161)}}function R(a){var d=a.fatal,f=0,c=!1,b=0;this.decode=function(a){var k=
a.get();-1!==k&&a.offset(1);switch(f){default:case 0:return 27===k?(f=1,null):g(k,0,127)?k:-1===k?-1:l(d);case 1:if(36===k||40===k)return b=k,f=2,null;-1!==k&&a.offset(-1);f=0;return l(d);case 2:var h=b;b=0;if(36===h&&(64===k||66===k))return c=!1,f=4,null;if(36===h&&40===k)return f=3,null;if(40===h&&(66===k||74===k))return f=0,null;if(40===h&&73===k)return f=6,null;-1===k?a.offset(-1):a.offset(-2);f=0;return l(d);case 3:if(68===k)return c=!0,f=4,null;-1===k?a.offset(-2):a.offset(-3);f=0;return l(d);
case 4:if(10===k)return f=0,l(d,10);if(27===k)return f=1,null;if(-1===k)return-1;b=k;f=5;return null;case 5:f=4;if(-1===k)return l(d);a=null;h=94*(b-33)+k-33;g(b,33,126)&&g(k,33,126)&&(a=!1===c?u(h,p.jis0208):u(h,p.jis0212));return null===a?l(d):a;case 6:return 27===k?(f=1,null):g(k,33,95)?65377+k-33:-1===k?-1:l(d)}}}function S(a){var d=0;this.encode=function(a,c){var b=c.get();if(-1===b)return-1;c.offset(1);if((g(b,0,127)||165===b||8254===b)&&0!==d)return c.offset(-1),d=0,a.emit(27,40,66);if(g(b,
0,127))return a.emit(b);if(165===b)return a.emit(92);if(8254===b)return a.emit(126);if(g(b,65377,65439)&&2!==d)return c.offset(-1),d=2,a.emit(27,40,73);if(g(b,65377,65439))return a.emit(b-65377-33);if(1!==d)return c.offset(-1),d=1,a.emit(27,36,66);var e=r(b,p.jis0208);if(null===e)return q(b);b=n(e,94)+33;return a.emit(b,e%94+33)}}function T(a){var d=a.fatal,f=0;this.decode=function(a){var b=a.get();if(-1===b&&0===f)return-1;if(-1===b&&0!==f)return f=0,l(d);a.offset(1);if(0!==f){var e=f;f=0;if(g(b,
64,126)||g(b,128,252))return a=u(188*(e-(160>e?129:193))+b-(127>b?64:65),p.jis0208),null===a?l(d):a;a.offset(-1);return l(d)}return g(b,0,128)?b:g(b,161,223)?65377+b-161:g(b,129,159)||g(b,224,252)?(f=b,null):l(d)}}function U(a){this.encode=function(a,f){var c=f.get();if(-1===c)return-1;f.offset(1);if(g(c,0,128))return a.emit(c);if(165===c)return a.emit(92);if(8254===c)return a.emit(126);if(g(c,65377,65439))return a.emit(c-65377+161);var b=r(c,p.jis0208);if(null===b)return q(c);c=n(b,188);b%=188;return a.emit(c+
(31>c?129:193),b+(63>b?64:65))}}function V(a){var d=a.fatal,f=0;this.decode=function(a){var b=a.get();if(-1===b&&0===f)return-1;if(-1===b&&0!==f)return f=0,l(d);a.offset(1);if(0!==f){var e=f,k=null;f=0;if(g(e,129,198)){var h=178*(e-129);g(b,65,90)?k=h+b-65:g(b,97,122)?k=h+26+b-97:g(b,129,254)&&(k=h+26+26+b-129)}g(e,199,253)&&g(b,161,254)&&(k=12460+94*(e-199)+(b-161));b=null===k?null:u(k,p["euc-kr"]);null===k&&a.offset(-1);return null===b?l(d):b}return g(b,0,127)?b:g(b,129,253)?(f=b,null):l(d)}}function W(a){this.encode=
function(a,f){var c=f.get();if(-1===c)return-1;f.offset(1);if(g(c,0,127))return a.emit(c);var b=r(c,p["euc-kr"]);if(null===b)return q(c);if(12460>b)return c=n(b,178)+129,b%=178,a.emit(c,b+(26>b?65:52>b?71:77));b-=12460;c=n(b,94)+199;return a.emit(c,b%94+161)}}function X(a){var d=a.fatal,f=0,c=0;this.decode=function(a){var e=a.get();-1!==e&&a.offset(1);switch(f){default:case 0:return 14===e?(f=4,null):15===e?null:27===e?(f=1,null):g(e,0,127)?e:-1===e?-1:l(d);case 1:if(36===e)return f=2,null;-1!==e&&
a.offset(-1);f=0;return l(d);case 2:if(41===e)return f=3,null;-1===e?a.offset(-1):a.offset(-2);f=0;return l(d);case 3:if(67===e)return f=0,null;-1===e?a.offset(-2):a.offset(-3);f=0;return l(d);case 4:if(10===e)return f=0,l(d,10);if(14===e)return null;if(15===e)return f=0,null;if(-1===e)return-1;c=e;f=5;return null;case 5:f=4;if(-1===e)return l(d);a=null;g(c,33,70)&&g(e,33,126)?a=u(178*(c-1)+52+e-1,p["euc-kr"]):g(c,71,126)&&g(e,33,126)&&(a=u(12460+94*(c-71)+(e-33),p["euc-kr"]));return null!==a?a:l(d)}}}
function Y(a){var d=!1,f=0;this.encode=function(a,b){var e=b.get();if(-1===e)return-1;d||(d=!0,a.emit(27,36,41,67));b.offset(1);if(g(e,0,127)&&0!==f)return b.offset(-1),f=0,a.emit(15);if(g(e,0,127))return a.emit(e);if(1!==f)return b.offset(-1),f=1,a.emit(14);var k=r(e,p["euc-kr"]);if(null===k)return q(e);var h;if(12460>k)return h=n(k,178)+1,k=k%178-26-26+1,g(h,33,70)&&g(k,33,126)?a.emit(h,k):q(e);k-=12460;h=n(k,94)+71;k=k%94+33;return g(h,71,126)&&g(k,33,126)?a.emit(h,k):q(e)}}function B(a,d){var f=
d.fatal,c=null,b=null;this.decode=function(e){var d=e.get();if(-1===d&&null===c&&null===b)return-1;if(-1===d&&(null!==c||null!==b))return l(f);e.offset(1);if(null===c)return c=d,null;d=a?(c<<8)+d:(d<<8)+c;c=null;if(null!==b){var h=b;b=null;if(g(d,56320,57343))return 65536+1024*(h-55296)+(d-56320);e.offset(-2);return l(f)}return g(d,55296,56319)?(b=d,null):g(d,56320,57343)?l(f):d}}function C(a,d){this.encode=function(d,c){function b(b){var c=b>>8;b&=255;return a?d.emit(c,b):d.emit(b,c)}var e=c.get();
if(-1===e)return-1;c.offset(1);g(e,55296,57343)&&q(e);if(65535>=e)return b(e);var k=n(e-65536,1024)+55296,e=(e-65536)%1024+56320;b(k);return b(e)}}function Z(a,d){return d.match([255,254])?(d.offset(2),"utf-16"):d.match([254,255])?(d.offset(2),"utf-16be"):d.match([239,187,191])?(d.offset(3),"utf-8"):a}function x(a,d){if(!this||this===t)return new x(a,d);a=a?String(a):"utf-8";d=Object(d);this._encoding=v(a);this._streaming=!1;this._encoder=null;this._options={fatal:!!d.fatal};Object.defineProperty?
Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name;return this}function y(a,d){if(!this||this===t)return new y(a,d);a=a?String(a):"utf-8";d=Object(d);this._encoding=v(a);this._streaming=!1;this._decoder=null;this._options={fatal:!!d.fatal};Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name;return this}var m={},w={};[{encodings:[{labels:["unicode-1-1-utf-8",
"utf-8","utf8"],name:"utf-8"}],heading:"The Encoding"},{encodings:[{labels:["cp864","ibm864"],name:"ibm864"},{labels:["cp866","ibm866"],name:"ibm866"},{labels:"csisolatin2 iso-8859-2 iso-ir-101 iso8859-2 iso_8859-2 l2 latin2".split(" "),name:"iso-8859-2"},{labels:"csisolatin3 iso-8859-3 iso_8859-3 iso-ir-109 l3 latin3".split(" "),name:"iso-8859-3"},{labels:"csisolatin4 iso-8859-4 iso_8859-4 iso-ir-110 l4 latin4".split(" "),name:"iso-8859-4"},{labels:["csisolatincyrillic","cyrillic","iso-8859-5","iso_8859-5",
"iso-ir-144"],name:"iso-8859-5"},{labels:"arabic csisolatinarabic ecma-114 iso-8859-6 iso_8859-6 iso-ir-127".split(" "),name:"iso-8859-6"},{labels:"csisolatingreek ecma-118 elot_928 greek greek8 iso-8859-7 iso_8859-7 iso-ir-126".split(" "),name:"iso-8859-7"},{labels:"csisolatinhebrew hebrew iso-8859-8 iso-8859-8-i iso-ir-138 iso_8859-8 visual".split(" "),name:"iso-8859-8"},{labels:"csisolatin6 iso-8859-10 iso-ir-157 iso8859-10 l6 latin6".split(" "),name:"iso-8859-10"},{labels:["iso-8859-13"],name:"iso-8859-13"},
{labels:["iso-8859-14","iso8859-14"],name:"iso-8859-14"},{labels:["iso-8859-15","iso_8859-15"],name:"iso-8859-15"},{labels:["iso-8859-16"],name:"iso-8859-16"},{labels:["koi8-r","koi8_r"],name:"koi8-r"},{labels:["koi8-u"],name:"koi8-u"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:["iso-8859-11","tis-620","windows-874"],name:"windows-874"},{labels:["windows-1250","x-cp1250"],name:"windows-1250"},{labels:["windows-1251","x-cp1251"],name:"windows-1251"},{labels:"ascii ansi_x3.4-1968 csisolatin1 iso-8859-1 iso8859-1 iso_8859-1 l1 latin1 us-ascii windows-1252".split(" "),
name:"windows-1252"},{labels:["cp1253","windows-1253"],name:"windows-1253"},{labels:"csisolatin5 iso-8859-9 iso-ir-148 l5 latin5 windows-1254".split(" "),name:"windows-1254"},{labels:["cp1255","windows-1255"],name:"windows-1255"},{labels:["cp1256","windows-1256"],name:"windows-1256"},{labels:["windows-1257"],name:"windows-1257"},{labels:["cp1258","windows-1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:"chinese csgb2312 csiso58gb231280 gb2312 gbk gb_2312 gb_2312-80 iso-ir-58 x-gbk".split(" "),
name:"gbk"},{labels:["gb18030"],name:"gb18030"},{labels:["hz-gb-2312"],name:"hz-gb-2312"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"euc-jp"},{labels:["csiso2022jp","iso-2022-jp"],name:"iso-2022-jp"},{labels:"csshiftjis ms_kanji shift-jis shift_jis sjis windows-31j x-sjis".split(" "),
name:"shift_jis"}],heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:"cseuckr csksc56011987 euc-kr iso-ir-149 korean ks_c_5601-1987 ks_c_5601-1989 ksc5601 ksc_5601 windows-949".split(" "),name:"euc-kr"},{labels:["csiso2022kr","iso-2022-kr"],name:"iso-2022-kr"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["utf-16","utf-16le"],name:"utf-16"},{labels:["utf-16be"],name:"utf-16be"}],heading:"Legacy utf-16 encodings"}].forEach(function(a){a.encodings.forEach(function(a){m[a.name]=
a;a.labels.forEach(function(f){w[f]=a})})});var p=t["encoding-indexes"]||{};m["utf-8"].getEncoder=function(a){return new I(a)};m["utf-8"].getDecoder=function(a){return new H(a)};(function(){"ibm864 ibm866 iso-8859-2 iso-8859-3 iso-8859-4 iso-8859-5 iso-8859-6 iso-8859-7 iso-8859-8 iso-8859-10 iso-8859-13 iso-8859-14 iso-8859-15 iso-8859-16 koi8-r koi8-u macintosh windows-874 windows-1250 windows-1251 windows-1252 windows-1253 windows-1254 windows-1255 windows-1256 windows-1257 windows-1258 x-mac-cyrillic".split(" ").forEach(function(a){var d=
m[a],f=p[a];d.getDecoder=function(a){return new J(f,a)};d.getEncoder=function(a){return new K(f,a)}})})();m.gbk.getEncoder=function(a){return new A(!1,a)};m.gbk.getDecoder=function(a){return new z(!1,a)};m.gb18030.getEncoder=function(a){return new A(!0,a)};m.gb18030.getDecoder=function(a){return new z(!0,a)};m["hz-gb-2312"].getEncoder=function(a){return new M(a)};m["hz-gb-2312"].getDecoder=function(a){return new L(a)};m.big5.getEncoder=function(a){return new O(a)};m.big5.getDecoder=function(a){return new N(a)};
m["euc-jp"].getEncoder=function(a){return new Q(a)};m["euc-jp"].getDecoder=function(a){return new P(a)};m["iso-2022-jp"].getEncoder=function(a){return new S(a)};m["iso-2022-jp"].getDecoder=function(a){return new R(a)};m.shift_jis.getEncoder=function(a){return new U(a)};m.shift_jis.getDecoder=function(a){return new T(a)};m["euc-kr"].getEncoder=function(a){return new W(a)};m["euc-kr"].getDecoder=function(a){return new V(a)};m["iso-2022-kr"].getEncoder=function(a){return new Y(a)};m["iso-2022-kr"].getDecoder=
function(a){return new X(a)};m["utf-16"].getEncoder=function(a){return new C(!1,a)};m["utf-16"].getDecoder=function(a){return new B(!1,a)};m["utf-16be"].getEncoder=function(a){return new C(!0,a)};m["utf-16be"].getDecoder=function(a){return new B(!0,a)};x.prototype={encode:function(a,d){a=a?String(a):"";d=Object(d);this._streaming||(this._encoder=this._encoding.getEncoder(this._options));this._streaming=!!d.stream;for(var f=[],c=new E(f),b=new F(a);-1!==b.get();)this._encoder.encode(c,b);if(!this._streaming){var e;
do e=this._encoder.encode(c,b);while(-1!==e);this._encoder=null}return new Uint8Array(f)}};y.prototype={decode:function(a,d){if(!a||"buffer"in a&&"byteOffset"in a&&"byteLength"in a)a||(a=new Uint8Array(0));else throw new TypeError("Expected ArrayBufferView");d=Object(d);this._streaming||(this._decoder=this._encoding.getDecoder(this._options));this._streaming=!!d.stream;var f=new Uint8Array(a.buffer,a.byteOffset,a.byteLength),f=new D(f),c=Z(this._encoding.name,f);if(v(c)!==this._encoding)throw Error("BOM mismatch");
for(var c=new G,b;-1!==f.get();)b=this._decoder.decode(f),null!==b&&-1!==b&&c.emit(b);if(!this._streaming){do b=this._decoder.decode(f),null!==b&&-1!==b&&c.emit(b);while(-1!==b);this._decoder=null}return c.string()}};t.TextEncoder=t.TextEncoder||x;t.TextDecoder=t.TextDecoder||y})(this);
DataStream=function(a,b,c){this._byteOffset=b||0;a instanceof ArrayBuffer?this.buffer=a:"object"==typeof a?(this.dataView=a,b&&(this._byteOffset+=b)):this.buffer=new ArrayBuffer(a||1);this.position=0;this.endianness=null==c?DataStream.LITTLE_ENDIAN:c};DataStream.prototype={};
void 0===Uint8Array.prototype.BYTES_PER_ELEMENT&&(Uint8Array.prototype.BYTES_PER_ELEMENT=Uint8Array.BYTES_PER_ELEMENT,Int8Array.prototype.BYTES_PER_ELEMENT=Int8Array.BYTES_PER_ELEMENT,Uint8ClampedArray.prototype.BYTES_PER_ELEMENT=Uint8ClampedArray.BYTES_PER_ELEMENT,Uint16Array.prototype.BYTES_PER_ELEMENT=Uint16Array.BYTES_PER_ELEMENT,Int16Array.prototype.BYTES_PER_ELEMENT=Int16Array.BYTES_PER_ELEMENT,Uint32Array.prototype.BYTES_PER_ELEMENT=Uint32Array.BYTES_PER_ELEMENT,Int32Array.prototype.BYTES_PER_ELEMENT=
Int32Array.BYTES_PER_ELEMENT,Float64Array.prototype.BYTES_PER_ELEMENT=Float64Array.BYTES_PER_ELEMENT);DataStream.prototype.save=function(a){var b=new Blob(this.buffer),c=window.webkitURL||window.URL;if(c&&c.createObjectURL){var b=c.createObjectURL(b),d=document.createElement("a");d.setAttribute("href",b);d.setAttribute("download",a);d.click();c.revokeObjectURL(b)}else throw"DataStream.save: Can't create object URL.";};DataStream.BIG_ENDIAN=!1;DataStream.LITTLE_ENDIAN=!0;
DataStream.prototype._dynamicSize=!0;Object.defineProperty(DataStream.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(a){a||this._trimAlloc();this._dynamicSize=a}});DataStream.prototype._byteLength=0;Object.defineProperty(DataStream.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}});
Object.defineProperty(DataStream.prototype,"buffer",{get:function(){this._trimAlloc();return this._buffer},set:function(a){this._buffer=a;this._dataView=new DataView(this._buffer,this._byteOffset);this._byteLength=this._buffer.byteLength}});Object.defineProperty(DataStream.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(a){this._byteOffset=a;this._dataView=new DataView(this._buffer,this._byteOffset);this._byteLength=this._buffer.byteLength}});
Object.defineProperty(DataStream.prototype,"dataView",{get:function(){return this._dataView},set:function(a){this._byteOffset=a.byteOffset;this._buffer=a.buffer;this._dataView=new DataView(this._buffer,this._byteOffset);this._byteLength=this._byteOffset+a.byteLength}});
DataStream.prototype._realloc=function(a){if(this._dynamicSize){a=this._byteOffset+this.position+a;var b=this._buffer.byteLength;if(a<=b)a>this._byteLength&&(this._byteLength=a);else{for(1>b&&(b=1);a>b;)b*=2;var b=new ArrayBuffer(b),c=new Uint8Array(this._buffer);(new Uint8Array(b,0,c.length)).set(c);this.buffer=b;this._byteLength=a}}};
DataStream.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var a=new ArrayBuffer(this._byteLength),b=new Uint8Array(a),c=new Uint8Array(this._buffer,0,b.length);b.set(c);this.buffer=a}};DataStream.prototype.seek=function(a){a=Math.max(0,Math.min(this.byteLength,a));this.position=isNaN(a)||!isFinite(a)?0:a};DataStream.prototype.isEof=function(){return this.position>=this.byteLength};
DataStream.prototype.mapInt32Array=function(a,b){this._realloc(4*a);var c=new Int32Array(this._buffer,this.byteOffset+this.position,a);DataStream.arrayToNative(c,null==b?this.endianness:b);this.position+=4*a;return c};DataStream.prototype.mapInt16Array=function(a,b){this._realloc(2*a);var c=new Int16Array(this._buffer,this.byteOffset+this.position,a);DataStream.arrayToNative(c,null==b?this.endianness:b);this.position+=2*a;return c};
DataStream.prototype.mapInt8Array=function(a){this._realloc(1*a);var b=new Int8Array(this._buffer,this.byteOffset+this.position,a);this.position+=1*a;return b};DataStream.prototype.mapUint32Array=function(a,b){this._realloc(4*a);var c=new Uint32Array(this._buffer,this.byteOffset+this.position,a);DataStream.arrayToNative(c,null==b?this.endianness:b);this.position+=4*a;return c};
DataStream.prototype.mapUint16Array=function(a,b){this._realloc(2*a);var c=new Uint16Array(this._buffer,this.byteOffset+this.position,a);DataStream.arrayToNative(c,null==b?this.endianness:b);this.position+=2*a;return c};DataStream.prototype.mapUint8Array=function(a){this._realloc(1*a);var b=new Uint8Array(this._buffer,this.byteOffset+this.position,a);this.position+=1*a;return b};
DataStream.prototype.mapFloat64Array=function(a,b){this._realloc(8*a);var c=new Float64Array(this._buffer,this.byteOffset+this.position,a);DataStream.arrayToNative(c,null==b?this.endianness:b);this.position+=8*a;return c};DataStream.prototype.mapFloat32Array=function(a,b){this._realloc(4*a);var c=new Float32Array(this._buffer,this.byteOffset+this.position,a);DataStream.arrayToNative(c,null==b?this.endianness:b);this.position+=4*a;return c};
DataStream.prototype.readInt32Array=function(a,b){a=null==a?this.byteLength-this.position/4:a;var c=new Int32Array(a);DataStream.memcpy(c.buffer,0,this.buffer,this.byteOffset+this.position,a*c.BYTES_PER_ELEMENT);DataStream.arrayToNative(c,null==b?this.endianness:b);this.position+=c.byteLength;return c};
DataStream.prototype.readInt16Array=function(a,b){a=null==a?this.byteLength-this.position/2:a;var c=new Int16Array(a);DataStream.memcpy(c.buffer,0,this.buffer,this.byteOffset+this.position,a*c.BYTES_PER_ELEMENT);DataStream.arrayToNative(c,null==b?this.endianness:b);this.position+=c.byteLength;return c};
DataStream.prototype.readInt8Array=function(a){a=null==a?this.byteLength-this.position:a;var b=new Int8Array(a);DataStream.memcpy(b.buffer,0,this.buffer,this.byteOffset+this.position,a*b.BYTES_PER_ELEMENT);this.position+=b.byteLength;return b};
DataStream.prototype.readUint32Array=function(a,b){a=null==a?this.byteLength-this.position/4:a;var c=new Uint32Array(a);DataStream.memcpy(c.buffer,0,this.buffer,this.byteOffset+this.position,a*c.BYTES_PER_ELEMENT);DataStream.arrayToNative(c,null==b?this.endianness:b);this.position+=c.byteLength;return c};
DataStream.prototype.readUint16Array=function(a,b){a=null==a?this.byteLength-this.position/2:a;var c=new Uint16Array(a);DataStream.memcpy(c.buffer,0,this.buffer,this.byteOffset+this.position,a*c.BYTES_PER_ELEMENT);DataStream.arrayToNative(c,null==b?this.endianness:b);this.position+=c.byteLength;return c};
DataStream.prototype.readUint8Array=function(a){a=null==a?this.byteLength-this.position:a;var b=new Uint8Array(a);DataStream.memcpy(b.buffer,0,this.buffer,this.byteOffset+this.position,a*b.BYTES_PER_ELEMENT);this.position+=b.byteLength;return b};
DataStream.prototype.readFloat64Array=function(a,b){a=null==a?this.byteLength-this.position/8:a;var c=new Float64Array(a);DataStream.memcpy(c.buffer,0,this.buffer,this.byteOffset+this.position,a*c.BYTES_PER_ELEMENT);DataStream.arrayToNative(c,null==b?this.endianness:b);this.position+=c.byteLength;return c};
DataStream.prototype.readFloat32Array=function(a,b){a=null==a?this.byteLength-this.position/4:a;var c=new Float32Array(a);DataStream.memcpy(c.buffer,0,this.buffer,this.byteOffset+this.position,a*c.BYTES_PER_ELEMENT);DataStream.arrayToNative(c,null==b?this.endianness:b);this.position+=c.byteLength;return c};
DataStream.prototype.writeInt32Array=function(a,b){this._realloc(4*a.length);if(a instanceof Int32Array&&0==(this.byteOffset+this.position)%a.BYTES_PER_ELEMENT)DataStream.memcpy(this._buffer,this.byteOffset+this.position,a.buffer,0,a.byteLength),this.mapInt32Array(a.length,b);else for(var c=0;c<a.length;c++)this.writeInt32(a[c],b)};
DataStream.prototype.writeInt16Array=function(a,b){this._realloc(2*a.length);if(a instanceof Int16Array&&0==(this.byteOffset+this.position)%a.BYTES_PER_ELEMENT)DataStream.memcpy(this._buffer,this.byteOffset+this.position,a.buffer,0,a.byteLength),this.mapInt16Array(a.length,b);else for(var c=0;c<a.length;c++)this.writeInt16(a[c],b)};
DataStream.prototype.writeInt8Array=function(a){this._realloc(1*a.length);if(a instanceof Int8Array&&0==(this.byteOffset+this.position)%a.BYTES_PER_ELEMENT)DataStream.memcpy(this._buffer,this.byteOffset+this.position,a.buffer,0,a.byteLength),this.mapInt8Array(a.length);else for(var b=0;b<a.length;b++)this.writeInt8(a[b])};
DataStream.prototype.writeUint32Array=function(a,b){this._realloc(4*a.length);if(a instanceof Uint32Array&&0==(this.byteOffset+this.position)%a.BYTES_PER_ELEMENT)DataStream.memcpy(this._buffer,this.byteOffset+this.position,a.buffer,0,a.byteLength),this.mapUint32Array(a.length,b);else for(var c=0;c<a.length;c++)this.writeUint32(a[c],b)};
DataStream.prototype.writeUint16Array=function(a,b){this._realloc(2*a.length);if(a instanceof Uint16Array&&0==(this.byteOffset+this.position)%a.BYTES_PER_ELEMENT)DataStream.memcpy(this._buffer,this.byteOffset+this.position,a.buffer,0,a.byteLength),this.mapUint16Array(a.length,b);else for(var c=0;c<a.length;c++)this.writeUint16(a[c],b)};
DataStream.prototype.writeUint8Array=function(a){this._realloc(1*a.length);if(a instanceof Uint8Array&&0==(this.byteOffset+this.position)%a.BYTES_PER_ELEMENT)DataStream.memcpy(this._buffer,this.byteOffset+this.position,a.buffer,0,a.byteLength),this.mapUint8Array(a.length);else for(var b=0;b<a.length;b++)this.writeUint8(a[b])};
DataStream.prototype.writeFloat64Array=function(a,b){this._realloc(8*a.length);if(a instanceof Float64Array&&0==(this.byteOffset+this.position)%a.BYTES_PER_ELEMENT)DataStream.memcpy(this._buffer,this.byteOffset+this.position,a.buffer,0,a.byteLength),this.mapFloat64Array(a.length,b);else for(var c=0;c<a.length;c++)this.writeFloat64(a[c],b)};
DataStream.prototype.writeFloat32Array=function(a,b){this._realloc(4*a.length);if(a instanceof Float32Array&&0==(this.byteOffset+this.position)%a.BYTES_PER_ELEMENT)DataStream.memcpy(this._buffer,this.byteOffset+this.position,a.buffer,0,a.byteLength),this.mapFloat32Array(a.length,b);else for(var c=0;c<a.length;c++)this.writeFloat32(a[c],b)};DataStream.prototype.readInt32=function(a){a=this._dataView.getInt32(this.position,null==a?this.endianness:a);this.position+=4;return a};
DataStream.prototype.readInt16=function(a){a=this._dataView.getInt16(this.position,null==a?this.endianness:a);this.position+=2;return a};DataStream.prototype.readInt8=function(){var a=this._dataView.getInt8(this.position);this.position+=1;return a};DataStream.prototype.readUint32=function(a){a=this._dataView.getUint32(this.position,null==a?this.endianness:a);this.position+=4;return a};
DataStream.prototype.readUint16=function(a){a=this._dataView.getUint16(this.position,null==a?this.endianness:a);this.position+=2;return a};DataStream.prototype.readUint8=function(){var a=this._dataView.getUint8(this.position);this.position+=1;return a};DataStream.prototype.readFloat32=function(a){a=this._dataView.getFloat32(this.position,null==a?this.endianness:a);this.position+=4;return a};
DataStream.prototype.readFloat64=function(a){a=this._dataView.getFloat64(this.position,null==a?this.endianness:a);this.position+=8;return a};DataStream.prototype.writeInt32=function(a,b){this._realloc(4);this._dataView.setInt32(this.position,a,null==b?this.endianness:b);this.position+=4};DataStream.prototype.writeInt16=function(a,b){this._realloc(2);this._dataView.setInt16(this.position,a,null==b?this.endianness:b);this.position+=2};
DataStream.prototype.writeInt8=function(a){this._realloc(1);this._dataView.setInt8(this.position,a);this.position+=1};DataStream.prototype.writeUint32=function(a,b){this._realloc(4);this._dataView.setUint32(this.position,a,null==b?this.endianness:b);this.position+=4};DataStream.prototype.writeUint16=function(a,b){this._realloc(2);this._dataView.setUint16(this.position,a,null==b?this.endianness:b);this.position+=2};
DataStream.prototype.writeUint8=function(a){this._realloc(1);this._dataView.setUint8(this.position,a);this.position+=1};DataStream.prototype.writeFloat32=function(a,b){this._realloc(4);this._dataView.setFloat32(this.position,a,null==b?this.endianness:b);this.position+=4};DataStream.prototype.writeFloat64=function(a,b){this._realloc(8);this._dataView.setFloat64(this.position,a,null==b?this.endianness:b);this.position+=8};DataStream.endianness=0<(new Int8Array((new Int16Array([1])).buffer))[0];
DataStream.memcpy=function(a,b,c,d,e){a=new Uint8Array(a,b,e);c=new Uint8Array(c,d,e);a.set(c)};DataStream.arrayToNative=function(a,b){return b==this.endianness?a:this.flipArrayEndianness(a)};DataStream.nativeToEndian=function(a,b){return this.endianness==b?a:this.flipArrayEndianness(a)};
DataStream.flipArrayEndianness=function(a){for(var b=new Uint8Array(a.buffer,a.byteOffset,a.byteLength),c=0;c<a.byteLength;c+=a.BYTES_PER_ELEMENT)for(var d=c+a.BYTES_PER_ELEMENT-1,e=c;d>e;d--,e++){var k=b[e];b[e]=b[d];b[d]=k}return a};DataStream.createStringFromArray=function(a){for(var b=[],c=0;c<a.length;c+=32768)b.push(String.fromCharCode.apply(null,a.subarray(c,c+32768)));return b.join("")};DataStream.prototype.failurePosition=0;
DataStream.prototype.readStruct=function(a){for(var b={},c,d=this.position,e=0;e<a.length;e+=2){c=a[e+1];c=this.readType(c,b);if(null==c)return 0==this.failurePosition&&(this.failurePosition=this.position),this.position=d,null;b[a[e]]=c}return b};DataStream.prototype.readUCS2String=function(a,b){return DataStream.createStringFromArray(this.readUint16Array(a,b))};
DataStream.prototype.writeUCS2String=function(a,b,c){null==c&&(c=a.length);for(var d=0;d<a.length&&d<c;d++)this.writeUint16(a.charCodeAt(d),b);for(;d<c;d++)this.writeUint16(0)};DataStream.prototype.readString=function(a,b){return null==b||"ASCII"==b?DataStream.createStringFromArray(this.mapUint8Array(null==a?this.byteLength-this.position:a)):(new TextDecoder(b)).decode(this.mapUint8Array(a))};
DataStream.prototype.writeString=function(a,b,c){if(null==b||"ASCII"==b)if(null!=c){b=0;var d=Math.min(a.length,c);for(b=0;b<d;b++)this.writeUint8(a.charCodeAt(b));for(;b<c;b++)this.writeUint8(0)}else for(b=0;b<a.length;b++)this.writeUint8(a.charCodeAt(b));else this.writeUint8Array((new TextEncoder(b)).encode(a.substring(0,c)))};
DataStream.prototype.readCString=function(a){var b=this.byteLength-this.position,c=new Uint8Array(this._buffer,this._byteOffset+this.position),d=b;null!=a&&(d=Math.min(a,b));for(var e=0;e<d&&0!=c[e];e++);c=DataStream.createStringFromArray(this.mapUint8Array(e));null!=a?this.position+=d-e:e!=b&&(this.position+=1);return c};
DataStream.prototype.writeCString=function(a,b){if(null!=b){for(var c=0,d=Math.min(a.length,b),c=0;c<d;c++)this.writeUint8(a.charCodeAt(c));for(;c<b;c++)this.writeUint8(0)}else{for(c=0;c<a.length;c++)this.writeUint8(a.charCodeAt(c));this.writeUint8(0)}};
DataStream.prototype.readType=function(a,b){if("function"==typeof a)return a(this,b);if("object"==typeof a&&!(a instanceof Array))return a.get(this,b);if(a instanceof Array&&3!=a.length)return this.readStruct(a,b);var c=null,d=null,e="ASCII",k=this.position,g;if("string"==typeof a&&/:/.test(a)){var f=a.split(":");a=f[0];g=f[1];d=null!=b[g]?parseInt(b[g]):parseInt(f[1])}"string"==typeof a&&/,/.test(a)&&(f=a.split(","),a=f[0],e=parseInt(f[1]));switch(a){case "uint8":c=this.readUint8();break;case "int8":c=
this.readInt8();break;case "uint16":c=this.readUint16(this.endianness);break;case "int16":c=this.readInt16(this.endianness);break;case "uint32":c=this.readUint32(this.endianness);break;case "int32":c=this.readInt32(this.endianness);break;case "float32":c=this.readFloat32(this.endianness);break;case "float64":c=this.readFloat64(this.endianness);break;case "uint16be":c=this.readUint16(DataStream.BIG_ENDIAN);break;case "int16be":c=this.readInt16(DataStream.BIG_ENDIAN);break;case "uint32be":c=this.readUint32(DataStream.BIG_ENDIAN);
break;case "int32be":c=this.readInt32(DataStream.BIG_ENDIAN);break;case "float32be":c=this.readFloat32(DataStream.BIG_ENDIAN);break;case "float64be":c=this.readFloat64(DataStream.BIG_ENDIAN);break;case "uint16le":c=this.readUint16(DataStream.LITTLE_ENDIAN);break;case "int16le":c=this.readInt16(DataStream.LITTLE_ENDIAN);break;case "uint32le":c=this.readUint32(DataStream.LITTLE_ENDIAN);break;case "int32le":c=this.readInt32(DataStream.LITTLE_ENDIAN);break;case "float32le":c=this.readFloat32(DataStream.LITTLE_ENDIAN);
break;case "float64le":c=this.readFloat64(DataStream.LITTLE_ENDIAN);break;case "cstring":c=this.readCString(d);break;case "string":c=this.readString(d,e);break;case "u16string":c=this.readUCS2String(d,this.endianness);break;case "u16stringle":c=this.readUCS2String(d,DataStream.LITTLE_ENDIAN);break;case "u16stringbe":c=this.readUCS2String(d,DataStream.BIG_ENDIAN);break;default:if(3==a.length)if(e=a[1],g=a[2],f=0,f="function"==typeof g?g(b,this,a):"string"==typeof g&&null!=b[g]?parseInt(b[g]):parseInt(g),
"string"==typeof e){var h=e.replace(/(le|be)$/,""),l=null;/le$/.test(e)?l=DataStream.LITTLE_ENDIAN:/be$/.test(e)&&(l=DataStream.BIG_ENDIAN);"*"==g&&(f=null);switch(h){case "uint8":c=this.readUint8Array(f);break;case "uint16":c=this.readUint16Array(f,l);break;case "uint32":c=this.readUint32Array(f,l);break;case "int8":c=this.readInt8Array(f);break;case "int16":c=this.readInt16Array(f,l);break;case "int32":c=this.readInt32Array(f,l);break;case "float32":c=this.readFloat32Array(f,l);break;case "float64":c=
this.readFloat64Array(f,l);break;case "cstring":case "utf16string":case "string":if(null==f)for(c=[];!this.isEof();){g=this.readType(e,b);if(null==g)break;c.push(g)}else for(c=Array(f),h=0;h<f;h++)c[h]=this.readType(e,b)}}else if("*"==g)for(c=[],this.buffer;;){g=this.position;try{h=this.readType(e,b);if(null==h){this.position=g;break}c.push(h)}catch(m){this.position=g;break}}else for(c=Array(f),h=0;h<f;h++){g=this.readType(e,b);if(null==g)return null;c[h]=g}}null!=d&&(this.position=k+d);return c};
DataStream.prototype.writeStruct=function(a,b){for(var c=0;c<a.length;c+=2)this.writeType(a[c+1],b[a[c]],b)};
DataStream.prototype.writeType=function(a,b,c){if("function"==typeof a)return a(this,b);if("object"==typeof a&&!(a instanceof Array))return a.set(this,b,c);c=null;var d="ASCII",e=this.position;if("string"==typeof a&&/:/.test(a)){var k=a.split(":");a=k[0];c=parseInt(k[1])}"string"==typeof a&&/,/.test(a)&&(k=a.split(","),a=k[0],d=parseInt(k[1]));switch(a){case "uint8":this.writeUint8(b);break;case "int8":this.writeInt8(b);break;case "uint16":this.writeUint16(b,this.endianness);break;case "int16":this.writeInt16(b,
this.endianness);break;case "uint32":this.writeUint32(b,this.endianness);break;case "int32":this.writeInt32(b,this.endianness);break;case "float32":this.writeFloat32(b,this.endianness);break;case "float64":this.writeFloat64(b,this.endianness);break;case "uint16be":this.writeUint16(b,DataStream.BIG_ENDIAN);break;case "int16be":this.writeInt16(b,DataStream.BIG_ENDIAN);break;case "uint32be":this.writeUint32(b,DataStream.BIG_ENDIAN);break;case "int32be":this.writeInt32(b,DataStream.BIG_ENDIAN);break;
case "float32be":this.writeFloat32(b,DataStream.BIG_ENDIAN);break;case "float64be":this.writeFloat64(b,DataStream.BIG_ENDIAN);break;case "uint16le":this.writeUint16(b,DataStream.LITTLE_ENDIAN);break;case "int16le":this.writeInt16(b,DataStream.LITTLE_ENDIAN);break;case "uint32le":this.writeUint32(b,DataStream.LITTLE_ENDIAN);break;case "int32le":this.writeInt32(b,DataStream.LITTLE_ENDIAN);break;case "float32le":this.writeFloat32(b,DataStream.LITTLE_ENDIAN);break;case "float64le":this.writeFloat64(b,
DataStream.LITTLE_ENDIAN);break;case "cstring":this.writeCString(b,c);break;case "string":this.writeString(b,d,c);break;case "u16string":this.writeUCS2String(b,this.endianness,c);break;case "u16stringle":this.writeUCS2String(b,DataStream.LITTLE_ENDIAN,c);break;case "u16stringbe":this.writeUCS2String(b,DataStream.BIG_ENDIAN,c);break;default:if(3==a.length)for(a=a[1],d=0;d<b.length;d++)this.writeType(a,b[d]);else this.writeStruct(a,b)}null!=c&&(this.position=e,this._realloc(c),this.position=e+c)};
"function"===typeof define&&define.amd&&define("DataStream",[],function(){return DataStream});"object"===typeof module&&module&&module.exports&&(module.exports=DataStream);